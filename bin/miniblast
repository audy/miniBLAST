#!/usr/bin/env ruby
require 'pathname'

LIBRARY_PATH = Pathname.new(__FILE__).realpath.dirname.parent.join('lib').to_s
$:.unshift(LIBRARY_PATH)

require 'dnaio'
require 'searcher'

fail "usage: #{__FILE__} database.fasta query.fasta [kmer]" unless ARGV.length == 2
database, query = ARGV
K = 35
searcher = Searcher.new K

File.open(database) do |handle|
  db = DnaIO.new handle
  db.each do |record|
    searcher.add record.sequence, record.name, 
  end
end

File.open(query) do |handle|
  qs = DnaIO.new handle
  qs.each do |record|
    hit = searcher.find record.sequence
    puts "#{record.name} -> #{hit}"
  end
end